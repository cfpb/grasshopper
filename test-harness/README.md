# Grasshopper Test Harness

## Introduction

This project serves as a testing tool for the Grasshopper project. It is not intended to be deployed to production with
the main software, but to provide some assistance in checking the quality of the Geocoder. 
The test harness provides a few programs that automate geocoding at a larger scale through batching, and provide results
for further analysis.

## Tools

### ExtractIndex

This program extracts the contents of an index to a file. It is useful for extracting indexes that contain
state level data from Elasticsearch, dumping them to a file that can be used for further processing. 
It requires the [hmda-geo](https://github.com/cfpb/hmda-geo) project to be running in order to add the Census Tract information
to the original address points. 

It can be run as follows from an `sbt` promt:

```shell
> project test_harness
> set mainClass in (Compile, run) := Some("grasshopper.test.ExtractIndex")
> run <index> <type>
```

The last command requires two parameters, `<index>` and `<type>` representing the corresponding index and type in Elasticsearch
The output from running this will be saved in the `test-harness/target` folder with the name `<index>-<type>`.csv
This file has the following structure:

`Input Address, Input Longitude,Input Latitude, Input Census Tract ID`


### TractOverlay

This program takes the output from the previous program. It will require both the `hmda-geo` project mentioned
above as well as the [Grasshopper Parser](https://github.com/cfpb/grasshopper-parser) running in order to produce results. 

It can be run as follows from an `sbt` prompt: 

```shell
> project test_harness
> set mainClass in (Compile, run) := Some("grasshopper.test.TractOverlay")
> run <path>
```

The last command requires one parameter, `<path>`, which is the absolute path to the file generated by `ExtractIndex`
The results are saved in the test-harness/target directory in a file called `census-results.csv`.
This file contains the following structure:

`Input Address, Input Longitude,Input Latitude, Input Census Tract ID, Census Longitude, Census Latitude, Distance, Output Census Tract ID` 

`Distance` is the distance in Km between the input point and the geocoded point.





